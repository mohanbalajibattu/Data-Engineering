{"$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"factoryName":{"type":"string","metadata":"Data Factory name"},"Ls_AzureDataLakeStorage":{"type":"string"}},"variables":{"factoryId":"[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"},"resources":[{"name":"[concat(parameters('factoryName'), '/PL_data_validation')]","type":"Microsoft.DataFactory/factories/pipelines","apiVersion":"2018-06-01","properties":{"activities":[{"name":"Data Validation","type":"ExecuteDataFlow","dependsOn":[],"policy":{"timeout":"0.12:00:00","retry":0,"retryIntervalInSeconds":30,"secureOutput":false,"secureInput":false},"userProperties":[],"typeProperties":{"dataflow":{"referenceName":"DF_Validation","type":"DataFlowReference","parameters":{},"datasetParameters":{"sourcedata":{},"errorrecordssink":{},"successrowssink":{}}},"staging":{},"compute":{"coreCount":8,"computeType":"General"},"traceLevel":"Fine"}}],"policy":{"elapsedTimeMetric":{},"cancelAfter":{}},"annotations":[]},"dependsOn":["[concat(variables('factoryId'), '/dataflows/DF_Validation')]"]},{"name":"[concat(parameters('factoryName'), '/DF_Validation')]","type":"Microsoft.DataFactory/factories/dataflows","apiVersion":"2018-06-01","properties":{"type":"MappingDataFlow","typeProperties":{"sources":[{"linkedService":{"referenceName":"[parameters('Ls_AzureDataLakeStorage')]","type":"LinkedServiceReference"},"name":"sourcedata"}],"sinks":[{"linkedService":{"referenceName":"[parameters('Ls_AzureDataLakeStorage')]","type":"LinkedServiceReference"},"name":"errorrecordssink"},{"linkedService":{"referenceName":"[parameters('Ls_AzureDataLakeStorage')]","type":"LinkedServiceReference"},"name":"successrowssink"}],"transformations":[{"name":"validationrules"},{"name":"split1"}],"scriptLines":["source(output(","          {_c0} as short,","          title as string,","          director as string,","          release_year as short,","          runtime as short,","          genre as string,","          rating as double,","          metascore as short,","          {gross(M)} as double","     ),","     useSchema: false,","     allowSchemaDrift: true,","     validateSchema: false,","     ignoreNoFilesFound: false,","     format: 'delimited',","     fileSystem: 'dataset',","     fileName: 'imdb_clean.csv',","     columnDelimiter: ',',","     escapeChar: '\\\\',","     quoteChar: '\\\"',","     columnNamesAsHeader: true) ~> sourcedata","sourcedata assert(expectTrue(and(between(release_year,1990,2015),greaterOrEqual(rating,8.0)), true, 'rule1')) ~> validationrules","validationrules split(hasError('rule1'),","     disjoint: false) ~> split1@(error, success)","split1@error sink(allowSchemaDrift: true,","     validateSchema: false,","     format: 'delimited',","     fileSystem: 'validated-data',","     folderPath: 'error-records/error.csv',","     columnDelimiter: ',',","     escapeChar: '\\\\',","     quoteChar: '\\\"',","     columnNamesAsHeader: false,","     umask: 0022,","     preCommands: [],","     postCommands: [],","     skipDuplicateMapInputs: true,","     skipDuplicateMapOutputs: true) ~> errorrecordssink","split1@success sink(allowSchemaDrift: true,","     validateSchema: false,","     format: 'delimited',","     fileSystem: 'validated-data',","     folderPath: 'success-rows/success.csv',","     columnDelimiter: ',',","     escapeChar: '\\\\',","     quoteChar: '\\\"',","     columnNamesAsHeader: false,","     umask: 0022,","     preCommands: [],","     postCommands: [],","     skipDuplicateMapInputs: true,","     skipDuplicateMapOutputs: true) ~> successrowssink"]}},"dependsOn":[]}]}